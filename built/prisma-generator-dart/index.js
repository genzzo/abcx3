"use strict";var K=Object.create;var h=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty;var H=(n,e,t)=>e in n?h(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var U=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var W=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of B(e))!z.call(n,a)&&a!==t&&h(n,a,{get:()=>e[a],enumerable:!(r=q(e,a))||r.enumerable});return n};var y=(n,e,t)=>(t=n!=null?K(k(n)):{},W(e||!n||!n.__esModule?h(t,"default",{value:n,enumerable:!0}):t,n));var P=(n,e,t)=>(H(n,typeof e!="symbol"?e+"":e,t),t);var L=U((fe,Y)=>{Y.exports={name:"@abcx3/prisma-generator-dart",description:"Generate Dart class files with to- and fromJson methods from a Prisma schema",version:"1.0.0",main:"src/generator.js",bin:{"prisma-generator-dart":"src/generator.js"},scripts:{},keywords:[],author:"",license:"ISC"}});var G=require("@prisma/generator-helper"),V=require("child_process"),d=y(require("path"));var F="prisma-generator-dart";var N=`/*
-----------------------------------------------------
THIS FILE WAS AUTOMATICALLY GENERATED (DO NOT MODIFY)
-----------------------------------------------------
*/

#{Imports}

class #{ClassName} #{ParentClass} {
    #{Properties}
    
      #{ClassName}({#{ConstructorArgs}});

      factory #{ClassName}.fromJson(Map<String, dynamic> json) =>
      #{ClassName}(
        #{fromJsonArgs}
      );

      Map<String, dynamic> toJson() => ({
        #{toJsonKeyValues}
      });
      }
    `,C="#{PropName}: json['#{PropName}'] as #{Type}#{Nullable}",b=`#{PropName}: (json['#{PropName}'] as List<#{Type}>#{Nullable})#{Nullable}
.map((item) => #{Type}.fromJson(item as Map<String, dynamic>)).toList()`,T="'#{PropName}': #{PropName}",S="'#{PropName}': #{PropName}#{Nullable}.map((item) => item.toJson()).toList()",v="#{Required} this.#{PropName}",x="#{Required} this.#{PropName} = #{DefaultValue}",A="#{Type}#{Nullable} #{PropName};";var u=y(require("fs")),J=y(require("path"));async function $(n,e){u.mkdirSync(J.dirname(n),{recursive:!0}),u.writeFileSync(n,e)}async function w(n,e){console.log(e)}var s=class{static decapitalizeFileName(e,t){return this.decapitalize(e)+"."+t}static decapitalize(e){return this.transformFirstCharCase(e,"toLowerCase")}static capitalize(e){return this.transformFirstCharCase(e,"toUpperCase")}static transformFirstCharCase(e,t){return e==null||e.length===0?"":(t==="toLowerCase"?e[0].toLowerCase():e[0].toUpperCase())+e.substring(1)}};var l=class{static getInstance(){return l.instance||(l.instance=new l),l.instance}getUniqueInputPropertyName(e){let t=e.primaryKey;if(t?.fields){let r=t.fields.reduce((a,o)=>a+"_"+o,"");return r=r.substring(1),r}else return null}getUniqueInputType(e){let t=e.primaryKey;return t?.fields?t.fields.reduce((a,o)=>a+s.capitalize(o),""):null}parseDocumentation(e){let t=e.documentation||"";t=t.replace(/(\r\n|\n|\r)/gm," ");let r=t.split(" "),a=[];for(let o of r){let i=o.indexOf("("),c=o.substring(i+1,o.lastIndexOf(")")),f={name:o.substring(0,i),argument:c};a.push(f)}return a}},m=l;P(m,"instance");var I={BigInt:"BigInt",Boolean:"bool",Bytes:"ByteBuffer",DateTime:"DateTime",Decimal:"double",Float:"double",Int:"int",Json:"Map<String, dynamic>",String:"String"},g=class{constructor(e,t){this.config=e;this.model=t;this.prismaHelper=m.getInstance()}importedPackages=[];omitFields=[];prismaHelper;generateContent(){let e=this.generateBaseInput();return e=e.replace(/#{Imports}/g,this.generateImportStatements()),e}generateBaseInput(){let e=N,t=this.model.name;e=e.replace(/#{ClassName}/g,t);let r="";e=e.replace(/#{ParentClass}/g,r);let a=[],o=[],i=[],c=[];for(let p of this.model.fields)this.prismaHelper.parseDocumentation(p).some(R=>R.name==="@ptools_omit")||(o.push(this.generatePropertyContent(p)),a.push(this.generateConstructorArg(p)),i.push(this.generateFromJsonArgument(p)),c.push(this.generateToJsonKeyVal(p)));let D=o.join(`
	`),f=a.join(`,
	`),j=i.join(`,
	`),O=c.join(`,
	`);return e=e.replace(/#{fromJsonArgs}/g,j),e=e.replace(/#{toJsonKeyValues}/g,O),e=e.replace(/#{Properties}/g,D),e=e.replace(/#{ConstructorArgs}/g,f),e}generateConstructorArg(e){let t="";if(e.hasDefaultValue&&!(e.default instanceof Object)){t=x;let r=e.default,a;e.kind==="enum"?a=`${e.type}.${r}`:a=typeof r=="string"?`"${r}"`:r.toString(),t=t.replace(/#{DefaultValue}/g,a),t=t.replace(/#{Required}/g,"")}else t=v,t=t.replace(/#{Required}/g,e.isRequired?"required":"");return t=t.replace(/#{PropName}/g,e.name),t}printDefaultValue(e){if(e.hasDefaultValue&&!(e.default instanceof Object)){let t=e.default,r;return e.kind==="enum"?`${e.type}.${t}`:typeof t=="string"?`"${t}"`:t.toString()}else return null}generateFromJsonArgument(e){let t=e.isList?b:C;return t=this.replacePropName(t,e),t=this.replaceNullable(t,e),t=this.replaceType(t,e),t}generateToJsonKeyVal(e){let t=e.isList?S:T;return t=this.replacePropName(t,e),t=this.replaceNullable(t,e),t}generatePropertyContent(e){let t=A;t=t.replace(/#{PropName}/g,e.name);let r=this.getDartType(e),a=e.isList?`List<${r}>`:r;return t=t.replace(/#{Type}/g,a),t=this.replaceNullable(t,e),t}getDartType=e=>I[e.type]||e.type;isProprietaryType=e=>I[e]==null;replaceNullable=(e,t)=>e.replace(/#{Nullable}/g,t.isRequired?"":"?");replacePropName=(e,t)=>e.replace(/#{PropName}/g,t.name);replaceType=(e,t)=>e.replace(/#{Type}/g,this.getDartType(t));generateImportStatements(){let e="",t=[];return this.model.fields.forEach(({type:r})=>{t.includes(r)||(t.push(r),this.isProprietaryType(r)&&(e+=`import '${s.decapitalizeFileName(r,"dart")}';
`))}),e}};var E=({name:n,values:e})=>{let t=e.map(({name:r})=>r).join(`,
	`);return`enum ${n} {
	${t}
}`};var{version:Q}=L(),X={dryRun:"false",schemaPath:"",EnumPath:"enums",FormatWithDart:"true",makeAllPropsOptional:"true"};(0,G.generatorHandler)({onManifest(){return console.log(`${F}:Registered`),{version:Q,defaultOutput:"../generated",prettyName:F}},onGenerate:async n=>{let e={schemaPath:n.schemaPath},t={...X,...n.generator.config,...e};console.log("hello from dart gen"),await new M(n,t).generateFiles()}});var M=class{constructor(e,t){this.options=e;this.settings=t;this.writeFile=t.dryRun==="false"?$:w,this.outputPath=this.options.generator.output?.value}dartFiles=[];writeFile;outputPath;async generateFiles(e=this.options,t=this.settings){for(let r of e.dmmf.datamodel.models)console.log(`Processing Model ${r.name}`),await this.generateDartModelFile(r);for(let r of e.dmmf.datamodel.enums)console.log(`Processing Enum ${r.name}`),await this.generateDartEnumFile(r);if(await this.createDartLibraryFile(),this.settings.FormatWithDart==="true"){let r=e.generator.output?.value;(0,V.exec)(`dart format "${r}"`,(a,o,i)=>{if(a){console.log("dart format couldn't run. Make sure you have Dart installed properly by going to https://dart.dev/get-dart"),console.log(`error: ${a.message}`);return}if(i){console.log(`stderr: ${i}`);return}console.log(`stdout: ${o}`)})}}async generateDartEnumFile(e){let t=E(e),r=`${s.decapitalizeFileName(e.name,"dart")}`,a=d.default.join(this.outputPath,r);console.log(` > Generating enum for Model ${e.name}`),await this.writeFile(a,t),this.dartFiles.push(r)}async createDartLibraryFile(){let e=this.dartFiles.reduce((r,a)=>r+`export '${a}';
`,""),t=d.default.join(this.outputPath,"models_library.dart");await this.writeFile(t,e)}async generateDartModelFile(e){let r=new g(this.settings,e).generateContent(),a=`${s.decapitalizeFileName(e.name,"dart")}`,o=d.default.join(this.outputPath,a);this.dartFiles.push(a),console.log(` > Generating Dart class for Model ${e.name}`),await this.writeFile(o,r)}};
